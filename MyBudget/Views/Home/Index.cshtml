@model IEnumerable<MyBudget.Models.Deposit>
@using System.Linq

@{
    ViewBag.Title = "Dashboard";
}

<h2>Dashboard</h2>

<div class="dashboard-grid">
    <!-- Sekcja skrótu depozytów po lewej stronie -->
    <div class="dashboard-card deposits-section">
        <h3>Account Balances</h3>

        @if (!Model.Any())
        {
            <p>No deposits available.</p>
        }
        else
        {
            <div class="dashboard-summary">
                <!-- Stały depozyt reprezentujący sumę wszystkich depozytów -->
                <div class="dashboard-deposit-card deposit-card-toggle" data-deposit="Sum_Deposits">
                    <h4>Sum Deposits</h4>
                    <p>Balance: <strong>@Model.Sum(d => d.Balance) PLN</strong></p> <!-- Suma wszystkich depozytów -->
                </div>

                <!-- Pętla dla każdego depozytu -->
                @foreach (var deposit in Model)
                {
                    <div class="dashboard-deposit-card deposit-card-toggle" data-deposit="@deposit.DepositName">
                        <h4>@deposit.DepositName</h4>
                        <p>Balance: <strong>@deposit.Balance @deposit.Currency</strong></p>
                    </div>
                }
            </div>
        }
    </div>

    <!-- Sekcja wykresów po prawej stronie -->
    <div class="dashboard-card charts-section">
        <h3>Savings Trends</h3>
        <iframe id="chart-frame" src="~/Graphs/Konto_PKO_BP_history.html" width="100%" height="800"></iframe>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Kliknięcie w depozyt
            $(".dashboard-deposit-card").click(function () {
                var depositName = $(this).data("deposit");
                var iframe = $("#chart-frame");

                // Zmieniamy aktywność przycisków (toggle)
                $(".dashboard-deposit-card").removeClass("active");
                $(this).addClass("active");

                // Sprawdzenie czy kliknięto "Sum Deposits"
                if (depositName === "Sum_Deposits") {
                    iframe.attr("src", "/Graphs/total_balance_history.html");
                } else {
                    var safeDepositName = depositName.replace(/\s+/g, "_");
                    iframe.attr("src", "/Graphs/" + safeDepositName + "_history.html");
                }
            });
        });
    </script>
}
